---
title: "Reactì™€ setTimeout ê·¸ë¦¬ê³  setIntervalì— ëŒ€í•œ ì´í•´. (feat.closure)"
date: "2022-65-08"
description: "ì‚¬ìš©ìê°€ ì£¼ë¬¸ ì‹œìŠ¤í…œ(OMS)ì— ì—…ë¡œë“œí•œ ì£¼ë¬¸ë‚´ì—­ì„ ì°½ê³ ê´€ë¦¬ ì‹œìŠ¤í…œ(WMS)ìœ¼ë¡œ ì „ì†¡í•˜ë˜ ê¸°ì¡´ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°œì„ í•˜ëŠ” ê³¼ì •ì—ì„œ ì–»ê²Œëœ ê¹¨ë‹¬ìŒì— ê´€í•œ ì´ì•¼ê¸°ì…ë‹ˆë‹¤. "
---

## ë“¤ì–´ê°€ë©°

íšŒì‚¬ì—ëŠ” 2ê°€ì§€ ì‹œìŠ¤í…œì´ ìˆë‹¤. í•˜ë‚˜ëŠ” ì£¼ë¬¸ê´€ë¦¬ì‹œìŠ¤í…œ (Order Management Sysyem), ë˜ ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ì°½ê³ ê´€ë¦¬ì‹œìŠ¤í…œ (Warehouse Management Sysyem) ì´ë‹¤. ê¸°ì¡´ì˜ ì£¼ë¬¸ ì „ì†¡ ë°©ì‹ì€ ëŒ€ëŸ‰ì˜ ì—…ë¡œë“œ ê±´ì„ ì²˜ë¦¬í•˜ëŠ”ë° ë¬¸ì œê°€ ë§ì•˜ë‹¤. ê·¸ë˜ì„œ ê¸°ì¡´ì—ëŠ” ì—…ë¡œë“œí•  ë°ì´í„°ë¥¼ ì†ŒëŸ‰ì”© ì§¤ë¼ì„œ dispatch í–ˆë‹¤ë©´, ìƒˆë¡œìš´ ë°©ì‹ìœ¼ë¡œëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ í•œë²ˆì— ì „ì†¡í•˜ê³  batchNumberë¥¼ ê°€ì§€ê³  ì§€ì†ì ìœ¼ë¡œ ```polling``` í•˜ë©´ì„œ ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆëŠ”ì§€ í™•ì¸ í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ êµ¬ì¶•í•˜ê¸°ë¡œ í—€ë‹¤.

## polling?

ìƒì†Œí•˜ì‹  ë¶„ë“¤ë„ ìˆìœ¼ë¦¬ë¼ ìƒê°ë©ë‹ˆë‹¤. ì € ì—­ì‹œ ìƒì†Œí•œ ë‹¨ì–´ì˜€ëŠ”ë°ìš”! ìœ„í‚¤ ë°±ê³¼ì—ì„œ ì°¾ì€ pollingì˜ ì •ì˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

ğŸƒ : **í´ë§(polling)** ì´ë€ í•˜ë‚˜ì˜ ì¥ì¹˜(ë˜ëŠ” í”„ë¡œê·¸ë¨)ê°€ ì¶©ëŒ íšŒí”¼ ë˜ëŠ” ë™ê¸°í™” ì²˜ë¦¬ ë“±ì„ ëª©ì ìœ¼ë¡œ ë‹¤ë¥¸ ì¥ì¹˜(ë˜ëŠ” í”„ë¡œê·¸ë¨)ì˜ ìƒíƒœë¥¼ __ì£¼ê¸°ì ìœ¼ë¡œ ê²€ì‚¬__ í•˜ì—¬ ì¼ì •í•œ ì¡°ê±´ì„ ë§Œì¡±í•  ë•Œ ì†¡ìˆ˜ì‹  ë“±ì˜ ìë£Œì²˜ë¦¬ë¥¼ í•˜ëŠ” ë°©ì‹ì„ ë§í•œë‹¤.


## ì–´ë–»ê²Œ ì£¼ê¸°ì ìœ¼ë¡œ ê²€ì‚¬í•´ì•¼ í• ê¹Œ?

ê²°ë¡ ì ìœ¼ë¡œ ë§í•˜ë©´ ì—¬ëŸ¬ ë°©ë²•ì´ ìˆê² ì§€ë§Œ ì œê°€ ìƒê°í•œ ë°©ë²•ì—ëŠ” 3ê°€ì§€ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

- setInterval

- setTimeout

- useInterval

ì£¼ê¸°ì ìœ¼ë¡œ íŠ¹ì • callback í•¨ìˆ˜ë¥¼ ì‹¤í–‰ ì‹œí‚¬ ìˆ˜ ìˆë‹¤ë©´ serverì— ì§€ì†ì ìœ¼ë¡œ ë°ì´í„°ê°€ ëª¨ë‘ ì²˜ë¦¬ ë˜ì—ˆëŠ”ì§€ ì§ˆì˜í•´ ë³¼ ìˆ˜ ìˆê² ë‹¤ëŠ” ê²°ë¡ ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.
3ê°€ì§€ ë°©ë²•ì„ ëª¨ë‘ ê³ ë ¤í•´ ë³´ê³  ì–´ë–¤ ê²ƒì´ ê°€ì¥ ì¢‹ì„ì§€ ìƒê°í•´ë³´ì•˜ëŠ”ë° ì•„ë˜ì—ì„œ ì°¬ì°¬íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

### setInterval ê³¼ setTimeoutì˜ ì°¨ì´?

ë§‰ìƒ ì–´ë–¤ í•¨ìˆ˜ë¥¼ ì„ íƒí•´ì•¼ ê°€ì¥ ìµœê³ ì˜ ì„ íƒì¼ê¹Œìš”? ë¬¼ë¡  ì›í•˜ëŠ” ë™ì‘ë§ˆë‹¤ ë‹¤ë¥´ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ê²°ì •ì ì¸ ì°¨ì´ëŠ” ë°”ë¡œ **ì‹œê°„ ë³´ì¥** ì…ë‹ˆë‹¤. â°

```javascript
let timerId = setInterval(func|code, [delay], [arg1], [arg2], ...)
```

  > ì‹œê°„ë§ˆë‹¤ ì£¼ê¸°ì ìœ¼ë¡œ í•´ë‹¹ func ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜.

```javascript
let timerId = setTimeout(func|code, [delay], [arg1], [arg2], ...)
```

  > ì¼ì • ì‹œê°„ í›„ì— í•´ë‹¹ func ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜.


ë‹¤ìŒ ê·¸ë¦¼ì„ ë³´ë©´ ì´í•´ê°€ ì‰½ìŠµë‹ˆë‹¤.

<img width='500px' src='https://user-images.githubusercontent.com/87749134/172602822-09332d4e-6254-4c1e-8bba-50f189613b65.png' />

ìœ„ì˜ ê·¸ë¦¼ì²˜ëŸ¼ setIntervalì€ *í•¨ìˆ˜ì˜ ì‹¤í–‰ ì‹œì  ë¶€í„° ì‹œê°„ì„ ì¡ê¸° ë•Œë¬¸* ì— ì‹¤ì œ í•¨ìˆ˜ í˜¸ì¶œì´ ì¢…ë£Œë˜ê³  ë‹¤ìŒ í•¨ìˆ˜ í˜¸ì¶œê¹Œì§€ì˜ ì‹œê°„ì€ ìš°ë¦¬ê°€ ì„¤ì •í•œ ì‹œê°„ë³´ë‹¤ í›¨ì”¬ ì§§ì•„ì§€ê²Œ ë©ë‹ˆë‹¤. ë°˜ë©´ì— setTimeoutì€ í•´ë‹¹ ì‹œê°„ë™ì•ˆ delay í›„ callback í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì„¤ì •í•œ ì‹œê°„ë§Œí¼ í™•ì‹¤íˆ delayë¥¼ ë³´ì¥í•´ ì¤ë‹ˆë‹¤. ì•„ì£¼ ë‹¹ì—°í•œ ê²°ê³¼ì´ì£ .

í•˜ì§€ë§Œ setInterval í•¨ìˆ˜ì—ì„œ ë§Œì•½ callback í•¨ìˆ˜ì˜ ì‹¤í–‰ ì‹œê°„ì´ ìš°ë¦¬ê°€ ì„¤ì •í•´ ë†“ì€ ì‹œê°„ë³´ë‹¤ ê¸¸ì–´ì§€ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?
ì—”ì§„ì€ ë‹¤í–‰íˆ ë¬µë¬µíˆ ê·¸ ì‹œê°„ì„ ê¸°ë‹¤ë ¤ ì¤ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ê±´ ìš°ë¦¬ê°€ ì›í•œ ê²°ê³¼ëŠ” ì•„ë‹ˆì£ . ê·¸ë ‡ë‹¤ë©´ setIntervalì€ ì§€ê¸ˆ ìƒí™©ì— ë§ì§€ ì•Šë‹¤...ğŸ¤¥ íƒˆë½.

setIntervalì€ ì£¼ê¸°ì ìœ¼ë¡œ callbackì„ ì‹¤í–‰ ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë‹ˆ ì¥ì ì´ ìˆë‹¤ê³  ìƒê°ì´ ë“œëŠ” ìˆœê°„ setTimeoutì€ ì£¼ê¸°ì ìœ¼ë¡œ callback í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ì—†ë‚˜? í•˜ëŠ” ì˜ë¬¸ë„ ë“¤ì£ . ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

#### ì¤‘ì²© setTimeout

```javascript
let delay = 5000;

let timerId = setTimeout(function request() {
  ...ìš”ì²­ ë³´ë‚´ê¸°...

  if (ì„œë²„ ê³¼ë¶€í•˜ë¡œ ì¸í•œ ìš”ì²­ ì‹¤íŒ¨) {
    // ìš”ì²­ ê°„ê²©ì„ ëŠ˜ë¦½ë‹ˆë‹¤.
    delay *= 2;
  }

  timerId = setTimeout(request, delay);

}, delay);
```

setTimeoutì„ ì¤‘ì²©í•˜ì—¬ ì‚¬ìš©í•œë‹¤ë©´ í™•ì‹¤í•˜ê²Œ ì¼ì •ê¸°ê°„ë§Œí¼ ì‹œê°„ì„ ë³´ì¥ ë°›ì„ ìˆ˜ë„ ìˆê³ , ë“¤ì–´ì˜¤ëŠ” ë°ì´í„°ì˜ ì–‘ì— ë”°ë¼ delayë¥¼ ìˆ˜ì • í•  ìˆ˜ë„ ìˆê² ë‹¤..! ì´ ë°©ë²•ì´ ê°€ì¥ ê¹”ë”í•˜ê² ì–´! ğŸ˜½ ë¼ëŠ” ê¸°ì¨ì´ ë“¤ë©° ì½”ë“œë¥¼ ì‘ì„±í–ˆëŠ”ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

### ì˜ˆê¸°ì¹˜ ëª»í•œ Closure (í´ë¡œì ¸)

â—ï¸ **Javascriptì—ì„œ Event Loopì™€ Call Stack, Callback Queueê°€ ë™ì‘í•˜ëŠ” ë°©ì‹ì„ ì‚´í´ë³´ì.**
JavascriptëŠ” Single thread ì–¸ì–´ì´ê¸° ë•Œë¬¸ì— ì—”ì§„ì€ í•˜ë‚˜ì˜ taskë§Œ ì‘ì—…ì´ ê°€ëŠ¥í•˜ë‹¤. ê·¸ë ‡ê¸° ë–„ë¬¸ì— ì‹¤í–‰ì´ ê¸´ í•¨ìˆ˜ë¥¼ ë§Œë‚˜ë©´ í™”ë©´ì´ ë©ˆì¶”ê²Œ ëœë‹¤. ì´ëŸ° ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•´ Web Apië¥¼ ì‚¬ìš©í•˜ê³ , Call Stackì—ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ Callback Queueì— ìŒ“ì´ê²Œ ë˜ê³ , ì´ QueueëŠ” Call Stackì´ ë¹„ë©´ ì‹¤í–‰ëœë‹¤.

setTimeoutì´ë‚˜ setIntervalë„ Web Api ì¤‘ì— í•˜ë‚˜ì´ê¸° ë•Œë¬¸ì— í˜¸ì¶œë˜ë©´ Callback Queueì— ìŒ“ì¸ë‹¤. ê·¸ë¦¬ê³  Call Stackì´ ë¹„ë©´ ì‹¤í–‰ë˜ê²Œ ëœë‹¤. ê·¸ë¦¬ê³  ğŸŒŸ *ì‹¤í–‰ëœ setTimeout, setIntervalì€ í•œë²ˆë§Œ í˜¸ì¶œ í›„ì— ë°”ë¡œ ì¢…ë£Œëœë‹¤. í•˜ì§€ë§Œ callback í•¨ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ë‚¨ì•„ìˆê²Œ ë˜ê³  ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.*

ë”°ë¼ì„œ setTimeout ì™¸ë¶€ì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ë¥¼ ê°€ì§€ê³  setTimeout ì•ˆì—ì„œ ì‹¤í–‰ì‹œí‚¨ë‹¤ë©´ setTimeoutì€ ì¢…ë£Œë˜ì—ˆì§€ë§Œ ê·¸ë–„ ê³¼ê±°ì˜ ê°’ì„ ê·¸ëŒ€ë¡œ ì°¸ì¡°í•˜ê³  ìˆê²Œ ëœë‹¤.

```javascript
// í´ë¡œì ¸ ì‹¤í–‰ ì˜ˆì‹œ. useEffect ì•ˆì—ì„œ numberë¥¼ consoleë¡œ ì°ì–´ë³´ë©´ í•­ìƒ 0ì´ë‹¤.
// useEffect ë°–ì—ì„œ ì½˜ì†”ì„ ì°ì–´ë³´ë©´ ì •ìƒ ë™ì‘í•œë‹¤.
export default function App() {
  const [number, setNumber] = useState(0);

  console.log("number", number); // ì •ìƒ ë™ì‘.
  useEffect(() => {
    const loop = setInterval(() => {
      setNumber((prev) => prev + 1);
      console.log("number", number); // í•­ìƒ 0.
      if (number === 10) clearInterval(loop);
    }, 1000);
  }, []);

  return <div className="App">number : {number}</div>;
}
```

### ì–´ë–»ê²Œ í•´ê²°í–ˆì–´?

ì•„ë˜ëŠ” Dan í˜•ë‹˜ê»˜ì„œ ë§Œë“  custom Hook ì´ë‹¤.

```javascript
import { useState, useEffect, useRef } from 'react';

function useInterval(callback, delay) {
  const savedCallback = useRef(); // ìµœê·¼ì— ë“¤ì–´ì˜¨ callbackì„ ì €ì¥í•  refë¥¼ í•˜ë‚˜ ë§Œë“ ë‹¤.

  useEffect(() => {
    savedCallback.current = callback; // callbackì´ ë°”ë€” ë•Œë§ˆë‹¤ refë¥¼ ì—…ë°ì´íŠ¸ í•´ì¤€ë‹¤.
  }, [callback]);

  useEffect(() => {
    function tick() {
      savedCallback.current(); // tickì´ ì‹¤í–‰ë˜ë©´ callback í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.
    }
    if (delay !== null) { // ë§Œì•½ delayê°€ nullì´ ì•„ë‹ˆë¼ë©´
      let id = setInterval(tick, delay); // delayì— ë§ì¶”ì–´ intervalì„ ìƒˆë¡œ ì‹¤í–‰ì‹œí‚¨ë‹¤.
      return () => clearInterval(id); // unmountë  ë•Œ clearIntervalì„ í•´ì¤€ë‹¤.
    }
  }, [delay]); // delayê°€ ë°”ë€” ë•Œë§ˆë‹¤ ìƒˆë¡œ ì‹¤í–‰ëœë‹¤.
}
```

Closureì— ì˜í•´ ìƒˆë¡­ê²Œ ë Œë”ë§ëœ ê°’ì— ì ‘ê·¼ í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ useRefë¥¼ í†µí•´ ìš°íšŒí•˜ëŠ” ë°©ë²•ì„ ë³´ê³  í•´ê²° ë°©ë²•ì„ ì°¾ì•„ëƒˆìŠµë‹ˆë‹¤. 
