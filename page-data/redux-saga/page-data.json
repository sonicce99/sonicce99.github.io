{"componentChunkName":"component---src-templates-blog-post-js","path":"/redux-saga/","result":{"data":{"site":{"siteMetadata":{"title":"동수의 로그북"}},"markdownRemark":{"id":"683e3b97-8468-5509-9c2f-3d1dbfa08aaf","excerpt":"About Redux-Saga Redux-saga는 앱의 side-effects (data fetching, 브라우저 캐시 접근)을 보다 쉽게 관리하고, 쉽고, 테스트하기 용이하며, 오류를 더 잘 처리하도록 하는 것을 목표로 합니다. 기본적인 모델은 saga…","html":"<h2 id=\"about-redux-saga\" style=\"position:relative;\">About Redux-Saga<a href=\"#about-redux-saga\" aria-label=\"about redux saga permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Redux-saga는 앱의 side-effects (data fetching, 브라우저 캐시 접근)을 보다 쉽게 관리하고, 쉽고, 테스트하기 용이하며, 오류를 더 잘 처리하도록 하는 것을 목표로 합니다.</p>\n<p>기본적인 모델은 saga는 앱에서 동작하는 별도의 thread와 같다는 점입니다. redux-saga는 redux의 미들웨어로서, redux actions로 부터 thread를 시작, 중지, 취소 시킬 수 있습니다.</p>\n<p>Generators라는 ES6 기능을 사용하여 이러한 비동기 흐름을 쉽게 읽고 쓰고 테스트할 수 있습니다. 이렇게 하면 이러한 비동기 흐름이 표준 동기 JavaScript 코드처럼 보입니다.</p>\n<p>data fetching을 처리하기 위해 이전에 redux-thunk를 사용했을 수 있습니다. redux thunk와 달리 콜백 지옥에 빠지지 않고 비동기 흐름을 쉽게 테스트할 수 있으며 작업이 순수하게 유지됩니다.</p>\n<h2 id=\"introduction\" style=\"position:relative;\">Introduction<a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"beginner-tutorial\" style=\"position:relative;\">Beginner Tutorial<a href=\"#beginner-tutorial\" aria-label=\"beginner tutorial permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><code class=\"language-text\">sagas.js</code>를 만들고 아래와 같은 코드를 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sagas.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">helloSaga</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello Sagas!\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>saga를 통작시키기 위해선 다음이 필요합니다.</p>\n<ul>\n<li>\n<p>saga middleware를 생성합니다.</p>\n</li>\n<li>\n<p>redux store에 saga middleware를 연결합니다.</p>\n</li>\n</ul>\n<p><code class=\"language-text\">main.js</code>를 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// main.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createStore<span class=\"token punctuation\">,</span> applyMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span>\n<span class=\"token keyword\">import</span> createSagaMiddleware <span class=\"token keyword\">from</span> <span class=\"token string\">'redux-saga'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> helloSaga <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./sagas'</span>\n\n<span class=\"token keyword\">const</span> sagaMiddleware <span class=\"token operator\">=</span> <span class=\"token function\">createSagaMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>\n  reducer<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">applyMiddleware</span><span class=\"token punctuation\">(</span>sagaMiddleware<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\nsagaMiddleware<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>helloSaga<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">action</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">type</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>type<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Counter\n      value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      onIncrement<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'INCREMENT'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      onDecrement<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DECREMENT'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      onIncrementAsync<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'INCREMENT_ASYNC'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nstore<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>render<span class=\"token punctuation\">)</span></code></pre></div>\n<p>첫번째로 <code class=\"language-text\">.sagas.js</code> 에서 모듈을 import합니다.</p>\n<p>그 다음 <code class=\"language-text\">redux-saga</code> 라이브러리에서 export 된 <code class=\"language-text\">createSagaMiddleware</code>를 사용하여 미들웨어를 생성할 수 있습니다.</p>\n<p>미들웨어를 생성하면 Store에 연결을 시킨 후 <code class=\"language-text\">helloSaga</code>를 run합니다.</p>\n<h4 id=\"making-asynchronous-calls\" style=\"position:relative;\">Making Asynchronous calls​<a href=\"#making-asynchronous-calls\" aria-label=\"making asynchronous calls permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p><code class=\"language-text\">Counter.js</code>를 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Counter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> value<span class=\"token punctuation\">,</span> onIncrement<span class=\"token punctuation\">,</span> onDecrement<span class=\"token punctuation\">,</span> onIncrementAsync <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onIncrementAsync<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>Increment after <span class=\"token number\">1</span> second<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n\n    <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onIncrement<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>Increment<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n\n    <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onDecrement<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>Decrement<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Clicked<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span> times<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>🌿 redux-thunk와 다르게 dispatch 대신 action 객체를 사용합니다.</p>\n<p><code class=\"language-text\">sagas.js</code>에 다음의 코드로 변경합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sagas.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> put<span class=\"token punctuation\">,</span> takeEvery <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"redux-saga/effects\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">delay</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">ms</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">helloSaga</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello Sagas!\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Our worker Saga: will perform the async increment task</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">incrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"INCREMENT\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Our watcher Saga: spawn a new incrementAsync task on each INCREMENT_ASYNC</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">watchIncrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">takeEvery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INCREMENT_ASYNC\"</span><span class=\"token punctuation\">,</span> incrementAsync<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>delay라는 함수를 생성했는데 이는 Generator를 <code class=\"language-text\">block</code> 하기 위해 사용합니다.</p>\n<p>Sagas는 redux-saga 미들웨어에 객체를 yield하는 Generator 함수로 구현됩니다.\nyield된 객체는 미들웨어가 해석해야 하는 일종의 명령입니다.\nPromise가 미들웨어에 yield되면 미들웨어는 Promise가 완료될 때까지 Saga를 일시 중단합니다.\n위의 예에서 incrementAsync Saga는 delay에 의해 Promise가 해결될 때까지 일시 중지되며, 이는 1초 후에 발생합니다.</p>\n<p>Promise가 resolve되면 미들웨어는 Saga를 재개하여 다음 yield까지 코드를 실행합니다.\n다음 명령문은 INCREMENT action을 dispatch하도록 미들웨어에 지시하는 put({type: ‘INCREMENT’}) 호출의 결과인 또 다른 yield된 객체입니다.</p>\n<p>put은 우리가 Effect라고 부르는 것의 한 예입니다.\nEffects는 미들웨어가 수행할 명령을 포함하는 일반 JavaScript 객체입니다.\n미들웨어가 Saga에서 생성된 Effects를 retrieves하면 Effets가 충족될 때까지 Saga가 일시 중지됩니다.</p>\n<p>요약하자면, incrementAsync Saga는 delay(1000)에 대한 호출을 통해 1초 동안 대기한 다음 INCREMENT 작업을 발송합니다.</p>\n<p>다음으로 또 다른 Saga watchIncrementAsync를 만들었습니다.\nredux-saga에서 제공하는 helper 함수인 takeEvery를 사용하여 발송된 INCREMENT_ASYNC 작업을 수신하고 매번 incrementAsync를 실행합니다.</p>\n<p>이제 우리는 2개의 Sagas를 가지고 있고, 우리는 그것들을 한 번에 시작해야 합니다.\n이를 위해 다른 Sagas 시작을 담당하는 rootSaga를 추가합니다. 동일한 파일 sagas.js에서 다음과 같이 파일을 리팩터링합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sagas.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> put<span class=\"token punctuation\">,</span> takeEvery<span class=\"token punctuation\">,</span> all <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"redux-saga/effects\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">delay</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">ms</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">helloSaga</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello Sagas!\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">incrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"INCREMENT\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">watchIncrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">takeEvery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INCREMENT_ASYNC\"</span><span class=\"token punctuation\">,</span> incrementAsync<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// notice how we now only export the rootSaga</span>\n<span class=\"token comment\">// single entry point to start all Sagas at once</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">rootSaga</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token function\">helloSaga</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">watchIncrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 middleware에 rootSaga를 전달합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> rootSaga <span class=\"token keyword\">from</span> <span class=\"token string\">'./sagas'</span>\n\n<span class=\"token keyword\">const</span> sagaMiddleware <span class=\"token operator\">=</span> <span class=\"token function\">createSagaMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token operator\">...</span>\nsagaMiddleware<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>rootSaga<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<h4 id=\"making-our-code-testable\" style=\"position:relative;\">Making our code testable<a href=\"#making-our-code-testable\" aria-label=\"making our code testable permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>incrementAsync Saga를 테스트하여 원하는 작업을 수행하는지 확인하려고 합니다.</p>\n<p>다른 파일 <code class=\"language-text\">sagas.spec.js</code>를 만듭니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sagas.spec.js</span>\n<span class=\"token keyword\">import</span> test <span class=\"token keyword\">from</span> <span class=\"token string\">\"tape\"</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> incrementAsync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./sagas\"</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"incrementAsync Saga test\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">assert</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> gen <span class=\"token operator\">=</span> <span class=\"token function\">incrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// now what ?</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>incrementAsync는 Generator 함수입니다.\n실행되면 iterator 객체를 반환하고 iterator의 next 메서드는 아래와 같은 객체를 반환합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">gen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// => { done: boolean, value: any }</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">gen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// => { done: false, value: &lt;result of calling delay(1000)> }</span>\ngen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// => { done: false, value: &lt;result of calling put({type: 'INCREMENT'})> }</span>\ngen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// => { done: true, value: undefined }</span></code></pre></div>\n<p>처음 2개의 호출은 yield 표현식의 결과를 반환합니다.\n세 번째 호출에서는 더 이상 yield가 없으므로 done 필드가 true로 설정됩니다.\n또한 incrementAsync Generator는 아무 것도 반환하지 않으므로(return 문 없음) value 필드는 undefined로 설정됩니다.</p>\n<p>따라서 이제 incrementAsync 내부의 논리를 테스트하려면 반환된 Generator를 반복하고 Generator에서 산출한 값을 확인해야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sagas.spec.js</span>\n<span class=\"token keyword\">import</span> test <span class=\"token keyword\">from</span> <span class=\"token string\">'tape'</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> incrementAsync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./sagas'</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'incrementAsync Saga test'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">assert</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> gen <span class=\"token operator\">=</span> <span class=\"token function\">incrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">deepEqual</span><span class=\"token punctuation\">(</span>\n    gen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">done</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token operator\">??</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'incrementAsync should return a Promise that will resolve after 1 second'</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>문제는 delay의 return 값을 테스트하는 방법입니다.\n우리는 Promise에 대해 간단한 동등성 테스트를 할 수 없습니다.\ndelay가 normal 값을 반환했다면 테스트하기가 더 쉬웠을 것입니다.</p>\n<p>redux-saga는 위의 진술을 가능하게 하는 방법을 제공합니다.\nincrementAsync 내에서 직접 delay(1000)를 호출하는 대신 간접적으로 호출하고 내보내기하여 이후의 심층 비교를 가능하게 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sagas.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> put<span class=\"token punctuation\">,</span> takeEvery<span class=\"token punctuation\">,</span> all<span class=\"token punctuation\">,</span> call <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"redux-saga/effects\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">delay</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">ms</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">incrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// use the call Effect</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>delay<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"INCREMENT\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>yield delay(1000) -> yield call(delay, 1000)로 변경되었습니다.<br>\n차이점이 뭘까요?</p>\n<p>첫번째는 next 호출자에게 전달되기 전에 평가됩니다.\n따라서 호출자가 얻는 것은 Promise입니다.</p>\n<p>두 번째 경우, yield 표현식 call(delay, 1000)은 next 호출자에게 전달되는 것입니다.\nput과 마찬가지로 call은 미들웨어가 주어진 인수로 주어진 함수를 호출하도록 지시하는 Effect를 반환합니다.\n실제로 put이나 call은 자체적으로 디스패치 또는 비동기 호출을 수행하지 않으며 일반 JavaScript 객체를 반환합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"INCREMENT\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// => { PUT: {type: 'INCREMENT'} }</span>\n<span class=\"token function\">call</span><span class=\"token punctuation\">(</span>delay<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// => { CALL: {fn: delay, args: [1000]}}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sagas.spec.js</span>\n<span class=\"token keyword\">import</span> test <span class=\"token keyword\">from</span> <span class=\"token string\">\"tape\"</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> put<span class=\"token punctuation\">,</span> call <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"redux-saga/effects\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> incrementAsync<span class=\"token punctuation\">,</span> delay <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./sagas\"</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"incrementAsync Saga test\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">assert</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> gen <span class=\"token operator\">=</span> <span class=\"token function\">incrementAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">deepEqual</span><span class=\"token punctuation\">(</span>\n    gen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>delay<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"incrementAsync Saga must call delay(1000)\"</span>\n  <span class=\"token punctuation\">)</span>\n\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">deepEqual</span><span class=\"token punctuation\">(</span>\n    gen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"INCREMENT\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"incrementAsync Saga must dispatch an INCREMENT action\"</span>\n  <span class=\"token punctuation\">)</span>\n\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">deepEqual</span><span class=\"token punctuation\">(</span>\n    gen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">done</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"incrementAsync Saga must be done\"</span>\n  <span class=\"token punctuation\">)</span>\n\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>put 및 call은 일반 객체를 반환하므로 테스트 코드에서 동일한 함수를 재사용할 수 있습니다.\n그리고 incrementAsync의 논리를 테스트하기 위해 generator를 반복하고 해당 값에 대해 deepEqual 테스트를 수행합니다.</p>\n<h3 id=\"basic-concepts\" style=\"position:relative;\">Basic Concepts<a href=\"#basic-concepts\" aria-label=\"basic concepts permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<h4 id=\"declarative-effects\" style=\"position:relative;\">Declarative Effects<a href=\"#declarative-effects\" aria-label=\"declarative effects permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>redux-saga에서 Sagas는 Generator 함수를 사용하여 구현됩니다.\nSaga 논리를 표현하기 위해 Generator에서 일반 JavaScript 객체를 생성합니다.\n우리는 이러한 객체를 Effects라고 부릅니다.\nEffect는 미들웨어에 의해 참조되는 객체입니다. 일부 작업(예: 일부 비동기 함수 호출, 저장소에 작업 발송 등)을 수행하기 위해 미들웨어에 대한 Effects를 볼 수 있습니다.</p>\n<p><code class=\"language-text\">redux-saga/effects</code> 에서 Effects를 가져올 수 있습니다.</p>\n<p>이 섹션과 다음 섹션에서는 몇 가지 기본 Effects를 소개합니다. 그리고 어떻게 Sagas를 쉽게 테스트할 수 있게 하는지 확인하세요.</p>\n<p>Sagas는 여러 형태의 Effects를 생성할 수 있습니다. 가장 쉬운 방법은 Promise를 생성하는 것입니다.</p>\n<p>예를 들어 PRODUCTS_REQUESTED 작업을 감시하는 Saga가 있다고 가정합니다. action에 매치되면 서버에서 제품 목록을 가져오는 작업을 시작합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> takeEvery <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"redux-saga/effects\"</span>\n<span class=\"token keyword\">import</span> Api <span class=\"token keyword\">from</span> <span class=\"token string\">\"./path/to/api\"</span>\n\n<span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">watchFetchProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">takeEvery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PRODUCTS_REQUESTED\"</span><span class=\"token punctuation\">,</span> fetchProducts<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">fetchProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> products <span class=\"token operator\">=</span> <span class=\"token keyword\">yield</span> Api<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/products\"</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#about-redux-saga\">About Redux-Saga</a></p>\n</li>\n<li>\n<p><a href=\"#introduction\">Introduction</a></p>\n<ul>\n<li>\n<p><a href=\"#beginner-tutorial\">Beginner Tutorial</a></p>\n<ul>\n<li><a href=\"#making-asynchronous-calls\">Making Asynchronous calls​</a></li>\n<li><a href=\"#making-our-code-testable\">Making our code testable</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#basic-concepts\">Basic Concepts</a></p>\n<ul>\n<li><a href=\"#declarative-effects\">Declarative Effects</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"React-Saga 공식문서 번역본","date":"July 12, 2023","description":"redux-saga의 공식문서를 읽고 내용을 정리합니다.","keywords":["react","자바스크립트","javascript","redux-saga","공식문서"]}},"previous":{"fields":{"slug":"/bitcoin/"},"frontmatter":{"title":"비트코인 백서 번역본 (Bitcoin White Paper)"}},"next":{"fields":{"slug":"/shopby/"},"frontmatter":{"title":"인앱결제 프로젝트 중 만난 일"}}},"pageContext":{"id":"683e3b97-8468-5509-9c2f-3d1dbfa08aaf","previousPostId":"296d7f05-844d-53ff-97bd-bd4d2d019a7d","nextPostId":"cb1d8143-d383-5f6b-a932-2dcb64a52185"}},"staticQueryHashes":["230163734","2664618587"],"slicesMap":{}}