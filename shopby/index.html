<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.11.0"/><meta data-react-helmet="true" name="title" content="인앱결제 프로젝트 중 만난 일"/><meta data-react-helmet="true" name="author" content="이동수"/><meta data-react-helmet="true" name="keywords" content="react,자바스크립트,javascript,shopby,캠핏,camfit,프론트엔드,frontend"/><meta data-react-helmet="true" name="description" content="캠핏에서 shopby를 통한 인앱결제 프로젝트 중 만났던 API 순차요청에 관한 이야기입니다."/><meta data-react-helmet="true" property="og:image" content="https://user-images.githubusercontent.com/87749134/211980126-272f62b8-c31a-44b8-95af-4340424a1076.png"/><meta data-react-helmet="true" property="og:title" content="동수의 로그북"/><meta data-react-helmet="true" property="og:description" content="캠핏에서 shopby를 통한 인앱결제 프로젝트 중 만났던 API 순차요청에 관한 이야기입니다."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="creator" content="sonicce99"/><meta data-react-helmet="true" name="google-site-verification" content="o58UgrrbQhwRiVlCKP8xnL9-fEeJO5sLCFQxuUxrP18"/><meta data-react-helmet="true" name="naver-site-verification" content="930be88b7d8b5aa34f4bc40a40e1f6204249d8a3"/><style data-href="/styles.6b214a52ab492c8113c0.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:"Noto Sans KR",sans-serif,Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Noto Sans KR",sans-serif,"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#c9d1d9;--color-text:#c9d1d9;--color-text-light:#c9d1d9;--color-heading:#fff;--color-heading-black:#fff;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:var(--fontSize-root);line-height:var(--lineHeight-normal)}body{background:#0d1117;color:var(--color-text);font-family:var(--font-body);font-size:var(--fontSize-1)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);border:0;height:1px}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-tight);margin-bottom:var(--spacing-6);margin-top:var(--spacing-12)}h2,h3,h4,h5,h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}h1{color:var(--color-heading-black);font-size:var(--fontSize-6);font-weight:var(--fontWeight-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}blockquote>p{font-size:16px}p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{list-style-image:none;list-style-position:outside;margin-bottom:var(--spacing-8);margin-left:var(--spacing-0);margin-right:var(--spacing-0)}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{border-collapse:collapse;border-spacing:.25rem;margin-bottom:var(--spacing-8);width:100%}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}img{object-fit:contain}em{display:block;text-align:center}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-header,.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-12)}.main-heading{font-size:var(--fontSize-7);margin:0}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{color:var(--color-primary);font-size:var(--fontSize-4);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-family:var(--font-heading);font-size:var(--fontSize-2);font-weight:var(--fontWeight-bold);text-decoration:none}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio p,.bio-avatar{margin-bottom:var(--spacing-0)}.bio-avatar{border-radius:100%;margin-right:var(--spacing-4);min-width:50px}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-family:var(--font-heading);font-size:var(--fontSize-2)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}.blog-section{max-width:calc(var(--maxWidth-wrapper) - 40px)}.tocContainer{border-left:2px solid #2a2a2a;font-size:15px;height:80vh;left:calc(50% + 270px);margin-left:6rem;overflow:scroll;position:fixed;top:3.6rem;width:20rem}.tocContainer ul{list-style:none;margin-left:16px;margin-top:8px}.tocContainer li{margin-bottom:8px}.tocContainer a{text-decoration:none}.tocContainer a:hover{color:#000}.tocContainer .selected{font-size:16px;text-decoration:underline}.tocContainer::-webkit-scrollbar{display:none}::-webkit-scrollbar{height:7px;width:7px}::-webkit-scrollbar-thumb{background:#ced0d1;border-radius:100px}.gatsby-resp-image-image{background-color:rgba(51,51,51,.1);box-shadow:none!important}@media (max-width:42rem){blockquote{margin-left:var(--spacing-0);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4)}ol,ul{list-style-position:inside}}@media (prefers-color-scheme:dark){.tocContainer a:hover{color:#fff}}@media (max-width:1400px){.tocContainer{display:none}}@media (prefers-color-scheme:dark){a>span:hover{color:#fff}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'GTM-M5W59LM2');</script><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .custom-class.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .custom-class.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .custom-class svg,
    h2 .custom-class svg,
    h3 .custom-class svg,
    h4 .custom-class svg,
    h5 .custom-class svg,
    h6 .custom-class svg {
      visibility: hidden;
    }
    h1:hover .custom-class svg,
    h2:hover .custom-class svg,
    h3:hover .custom-class svg,
    h4:hover .custom-class svg,
    h5:hover .custom-class svg,
    h6:hover .custom-class svg,
    h1 .custom-class:focus svg,
    h2 .custom-class:focus svg,
    h3 .custom-class:focus svg,
    h4 .custom-class:focus svg,
    h5 .custom-class:focus svg,
    h6 .custom-class:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=300e9efb654785ab2bbb3cfad0cd6ea4" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=300e9efb654785ab2bbb3cfad0cd6ea4"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=300e9efb654785ab2bbb3cfad0cd6ea4"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=300e9efb654785ab2bbb3cfad0cd6ea4"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=300e9efb654785ab2bbb3cfad0cd6ea4"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=300e9efb654785ab2bbb3cfad0cd6ea4"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=300e9efb654785ab2bbb3cfad0cd6ea4"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=300e9efb654785ab2bbb3cfad0cd6ea4"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=300e9efb654785ab2bbb3cfad0cd6ea4"/><title data-react-helmet="true">인앱결제 프로젝트 중 만난 일 | 동수의 로그북</title><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer',GTM-M5W59LM2);</script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M5W59LM2" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M5W59LM2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><a class="header-link-home" href="/">동수의 로그북</a></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">인앱결제 프로젝트 중 만난 일</h1><p>October 23, 2023</p></header><section class="blog-section" itemProp="articleBody"><h2 id="들어가며" style="position:relative;">들어가며<a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0" aria-label="들어가며 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>안녕하세요. <a href="https://camfit.co.kr/" target="_blank">캠핏</a>의 웹 프론트개발자 이동수입니다.</p>
<p>현재 캠핏 앱은 웹뷰를 사용하고 있습니다.</p>
<p>실제로 대부분의 캠핏 사용자들이 앱을 사용하고 있기 때문에 회사에서는 앱의 사용자 경험을 가장 중요하게 생각하고, 이를 향상 시키고자 항상 노력하고 있습니다. 그 일환 중 하나로 <strong>인앱결제</strong> 프로젝트를 올해 진행했습니다.</p>
<p>기존에는 <a href="https://smartstore.naver.com/camfit" target="_blank">캠핏 스마트스토어</a>가 있어서 앱내에서 결제 시 스마트스토어 외부링크로 빠졌었는데 앱내에서 결제를 가능하게 하고자 NHN Commerce에서 제공하는 <a href="https://www.nhn-commerce.com/z/shopby" target="_blank">shopby</a>를 사용하여 인앱 결제 플로우를 개발했습니다.</p>
<p>안앱결제 플로우를 개발하는 과정에서 있었던 이슈 중 하나를 여러분에게 소개하고자 합니다.</p>
<h2 id="로그인이-유지되는-이유" style="position:relative;">로그인이 유지되는 이유<a href="#%EB%A1%9C%EA%B7%B8%EC%9D%B8%EC%9D%B4-%EC%9C%A0%EC%A7%80%EB%90%98%EB%8A%94-%EC%9D%B4%EC%9C%A0" aria-label="로그인이 유지되는 이유 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>한번 로그인을 해두면 일정시간동안 다음에 다시 해당 사이트를 방문했을 때 자동으로 로그인이 되어있는 경험을 모두가 자주 하셨을것 같습니다.</p>
<p>이게 가능한 이유가 뭘까요?</p>
<p>이것이 가능한 이유는 네이버를 예로 들면 사용자가 로그인을 했을 때, 네이버 서버가 사용자의 <u>브라우저 어딘가에 <strong>사용자의 로그인 정보</strong></u>를 저장해두기 때문입니다.</p>
<p>그래서 네이버에 접속했을 때 브라우저에 사용자의 로그인 정보가 저장되어 있다면 로그인 되어 있는 상태를 가질 수 있는 것입니다.</p>
<p>이때 보안상의 이유로 브라우저에 사용자의 로그인 정보를 저장하기 위해서는 2가지의 조건이 있습니다.</p>
<ol>
<li>
<p>로그인 정보는 도메인에 종속됩니다.</p>
</li>
<li>
<p>로그인 정보는 유효기한이 존재 할 수 있습니다.</p>
</li>
</ol>
<p>그래서 크롬에서 로그인한 뒤에 사파리에서 네이버를 접속하면 로그인이 되어있지 않으며, 서버에서 정한 유효시간이 지나면 다시 로그인을 해야하는 것입니다.</p>
<h2 id="json-web-token" style="position:relative;">JSON WEB TOKEN<a href="#json-web-token" aria-label="json web token permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>사용자의 로그인 정보를 브라우저에 저장하기 위한 방식으로 <strong><a href="https://jwt.io/" target="_blank">JSON WEB TOKEN</a></strong>을 많이 사용합니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6801f498ca26c7574b89d86834256637/ab622/jwt.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.012269938650306%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAACdeAAAnXgHPwViOAAAB9UlEQVR42hXHa0/aUBgA4P5tWSK6RTZdzDDxMi8fRqIOozJ2kxnZcJlFQUAmUqdAKbcWEHpu7zmFlnIWvz2PwhCGmVnUtDB3CRGECEwchDkmAmOBiaDUoYwLQZgv+GPJmQ8wl3KOAZgywMgYmPqT2US9hm0atll7atWf268+tWuDdpv0mrhligdTVCyn1nb+6bTQcxuEUoVAb+DWaF+j1StqFKCWg2aRt25p5RLXs6yeo0YeWresUaL1Ihh3+PEadbXx6jJT0wr2xhgoEMoxoTaiQ5sNbeY4AJwjxIaD5z7DZgAUKLeRAA75PDEMRSYSEkCMR4wxKae+P5lKKTPZcVkjY9cRjpRSTqe+lFNNmxQK1PMYgOf7UykVsb4JVr9h9R4qOojRxPXGUrpfjvD5WbXb6vc73kSMRuBL6SXP4PjoUder5TIMB57gysGlHj7MbsYLG5/yK9F0w7Tvaqfx/Gbqfi95vZ1Ivz9R164ejpHZKW6tJt68+h4MJBfmLkJz97sR5WPiJrASW4ykAuGjxUiq0bG1ZjISn02oa4eny3tfl07+rN/UvyGrcxmaSwVn1IWguhC8mH+hfdhRYj//bhxndj7ntuLXW/Fsy7LL+vnp1bZ6e3Ce3/+di2buYiX9F+pa2bWwGn774/XL5FIo826pFN39D4tvxf8wYMHqAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="jwt"
        title=""
        src="/static/6801f498ca26c7574b89d86834256637/a6d36/jwt.png"
        srcset="/static/6801f498ca26c7574b89d86834256637/222b7/jwt.png 163w,
/static/6801f498ca26c7574b89d86834256637/ff46a/jwt.png 325w,
/static/6801f498ca26c7574b89d86834256637/a6d36/jwt.png 650w,
/static/6801f498ca26c7574b89d86834256637/e548f/jwt.png 975w,
/static/6801f498ca26c7574b89d86834256637/3c492/jwt.png 1300w,
/static/6801f498ca26c7574b89d86834256637/ab622/jwt.png 2381w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>JWT는 3가지 (Header, Payload, Signature)부분으로 구분되어 있으며, 각각은 .(점)으로 구분됩니다.
(사진을 자세히 보시면 엄청나게 긴 문자열에 2개의 점이 있습니다.)</p>
<p>JWT에 대한 세부적인 내용은 이 블로그의 목적을 벗어나므로 자세히 소개하지는 않겠습니다.</p>
<p>(자세한 내용은 <a href="https://research.securitum.com/jwt-json-web-token-security/" target="_blank">여기</a>를 참조해주세요.)</p>
<p>결과적으로 사용자가 자신의 아이디와 패스워드를 입력하면 서버는 해당 아이디와 비밀번호가 유효한지 체크하고 유효한 경우, JWT를 생성하여 사용자 브라우저의 로컬스토리지 or 쿠키에 심어 돌려주게되고 사용자는 해당 JWT를 사용하여 서버 자원에 접근 인가(Authorization) 받게 됩니다.</p>
<p>그리고 유저가 어떤 정보를 http 요청하게 되면 이 JWT는 <strong>HTTP header</strong>속에 담기게 되어 서버에 전송되게 됩니다.</p>
<h2 id="오류-겹치기" style="position:relative;">오류 겹치기<a href="#%EC%98%A4%EB%A5%98-%EA%B2%B9%EC%B9%98%EA%B8%B0" aria-label="오류 겹치기 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>동수는 최근 회사에서 점심을 먹고 커피를 자주 마시게 되었습니다.</p>
<p>그런데 3개월쯤 하다보니, 커피를 마실 때 생기는 플라스틱이 한번 쓰고 버리긴 너무 아깝다는 생각이 들게되었고, 지구를 지키자?는 마음으로 텀블러를 구매하기 위해 쿠팡에 들어갔습니다.</p>
<p>텀블러를 구매하기하기 위해 쿠팡은 다음과 같은 정보를 유저에게 보여줘야하는 상황입니다.</p>
<ol>
<li>
<p>유저의 최근 배송지 주소</p>
</li>
<li>
<p>유저가 사용가능한 적립금</p>
</li>
<li>
<p>유저의 주문, 반품, 환불 내역</p>
</li>
</ol>
<p>쿠팡은 유저의 3가지의 정보를 서버에 받아오기 위해서 서버에 3번의 요청해야합니다.</p>
<p>이때 정상적으로 응답이 오게되면 데이터를 받을 수 있지만, 무엇인가 잘못된 경우 유저에게 잘못되었다는걸 알려줘야합니다.</p>
<p>그런데 하필 동수가 처음 쿠팡에 접속한지 하루가 지나버려 JWT의 유효기간이 지났고, 기한이 만료된 잘못된 JWT로 3개의 요청을 서버에 보냈습니다.</p>
<p>당연히 3개의 응답이 모두 정상적인 인가를 받지 못했습니다.</p>
<p>아래 버튼을 한번 눌러보세요.</p>
<iframe class="example-frame" width="100%" height='100px' src="https://sonicce99.github.io/api-sequential-requests/parallel/"></iframe>
<p>3개의 요청을 보냈고 3개의 요청이 실패했으니, 각각에 대해 잘못되었다고 유저에게 응답을 해주었습니다.</p>
<p>하지만 어떤가요?</p>
<p>유저는 버튼을 한번 클릭했을 뿐인데 알림이 3개가 나타나고 있습니다.</p>
<p>실제 서비스에서 이렇게 동작한다면 유저의 사용자경험이 감소할 것입니다.</p>
<p>위의 동작을 코드로 표현해보겠습니다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// 1초후 에러를 반환하는 promise.</span>
<span class="token keyword">const</span> <span class="token function-variable function">apiRequest</span> <span class="token operator">=</span> <span class="token parameter">request</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">이것은 유효기한이 만료된 JWT</span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>jwt <span class="token operator">===</span> <span class="token string">"이것은 유효기한이 만료된 JWT"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 에러!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 성공!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> requests <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"최근 배송지 주소 가져오기"</span><span class="token punctuation">,</span>
    <span class="token string">"사용가능한 적립금 가져오기"</span><span class="token punctuation">,</span>
    <span class="token string">"주문, 반품, 환불 내역 가져오기"</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">const</span> promises <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">request</span> <span class="token operator">=></span> <span class="token function">apiRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span>

  results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> reason <span class="token punctuation">}</span> <span class="token operator">=</span> result

    <span class="token comment">// promise가 거부될 경우.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token string">"rejected"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 텀블러 구매하기 버튼 클릭 시 동작.</span>
<span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>onClick 함수를 보면 map을 사용하여 apiRequest를 병렬적으로 실행하고 있습니다.</p>
<p>잘못된 jwt를 가지고 동시에 3개의 요청을 보냈기 때문에 실패한 응답이 3개가 올 수 밖에 없습니다. (주륵🥲)</p>
<p>이렇게 사용자 경험이 떨어질 수 있는 문제를 어떻게 해결할 수 있을까요?</p>
<p>인앱결제 프로젝트 도중 위와 같은 문제에 직면하게 되었고 저희 캠핏 프론트엔드 팀은 아래와 같이 문제를 해결했습니다.</p>
<h2 id="api-순차-요청" style="position:relative;">API 순차 요청<a href="#api-%EC%88%9C%EC%B0%A8-%EC%9A%94%EC%B2%AD" aria-label="api 순차 요청 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>JWT 시간 만료와 같이 <u>하나의 값이 정상적이지 않아 이후의 모든 API 요청 결과 역시 부정적 영향을 미칠 가능성</u>이 있는 요청들의 경우, <strong>순차적</strong>으로 요청을 보내고 정상적인 응답이 온 경우에만 다음 요청을 보내도록 합니다.</p>
<p>저희는 API 요청을 보내기 위한 Queue를 하나 생성했습니다.</p>
<p>API 요청이 들어오면 Queue에 push 해두고, 요청이 성공했을 때만 Queue에서 해당 요청을 dequeue 후 다음 요청을 하게합니다.</p>
<p>아래 순차 요청 버튼을 클릭해보세요!</p>
<iframe class="example-frame" width="100%" height='100px' src="https://sonicce99.github.io/api-sequential-requests/sequential/"></iframe>
<p>이제는 오류가 겹치지 않습니다!</p>
<p>어떻게 변경되었는지 코드로 한번 보겠습니다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// api 순차 요청 하기 위한 queue가 새로 생성</span>
<span class="token keyword">const</span> apiQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> jwt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">이것은 유효기한이 만료된 JWT</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> <span class="token function-variable function">apiRequest</span> <span class="token operator">=</span> <span class="token parameter">request</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>jwt <span class="token operator">===</span> <span class="token string">"이것은 유효기한이 만료된 JWT"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 에러!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 성공!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">sequentialRequests</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> req_path <span class="token operator">=</span> apiQueue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">await</span> <span class="token function">apiRequest</span><span class="token punctuation">(</span>req_path<span class="token punctuation">)</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">success </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req_path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// api 요청 성공 시 dequeue.</span>
    apiQueue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>apiQueue<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sequentialRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>error <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> JWT를 다시 받아오겠습니다.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    jwt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">이것은 정상적인 JWT</span><span class="token template-punctuation string">`</span></span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>apiQueue<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sequentialRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">path</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  apiQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>

  <span class="token comment">// 최초 요청이 들어왔을 때만 순차 요청 함수 실행.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>apiQueue<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sequentialRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">onClick</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1. 최근 배송지 주소 가져오기</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token comment">// 0.3초 후 다른 여러 api 요청이 queue에 enqueue된다고 가정.</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  apiQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">2. 사용가능한 적립금 가져오기</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  apiQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">3. 주문, 반품, 환불 내역 가져오기</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span></code></pre></div>
<p>처음에 저희는 3가지의 요청이 있다고 가정했었습니다.</p>
<ol>
<li>
<p>유저의 최근 배송지 주소</p>
</li>
<li>
<p>유저가 사용가능한 적립금</p>
</li>
<li>
<p>유저의 주문, 반품, 환불 내역</p>
</li>
</ol>
<p>첫번째로 ‘최근 배송지 주소 가져오기’ 요청을 시도했는데 만료된 JWT로 요청을 했기 때문에 Error가 발생했습니다.</p>
<p>첫번째 요청에서 에러가 발생했기 때문에 2번째, 3번째 요청을 실행하지 않습니다.👍</p>
<p>JWT를 새로 받아온 이후 정상적인 JWT를 가지고 첫번째 요청을 재시도하고 이후 순차적으로 요청을 시도하게 됩니다.</p>
<h2 id="인앱결제-프로젝트에-대한-회고" style="position:relative;">인앱결제 프로젝트에 대한 회고<a href="#%EC%9D%B8%EC%95%B1%EA%B2%B0%EC%A0%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%97%90-%EB%8C%80%ED%95%9C-%ED%9A%8C%EA%B3%A0" aria-label="인앱결제 프로젝트에 대한 회고 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>인앱결제 프로젝트를 배포하고, 디자인팀, 프론트엔드, 백엔드팀, 커머스팀, 운영팀, 영업팀 등 여러 팀이 모여 회고를 진행했습니다. 이번 캠핏에는 큰 변화가 있었습니다.</p>
<p>기존에는 하나의 프로젝트를 명확한 기한이 없이 스프린트(Sprint) 형식으로 진행했었지만, 이번 프로젝트부터는 <strong><em>이터레이션(Iteration)</em></strong>으로 배포까지 6주간의 기한을 명확히 두고 프로젝트가 진행되었습니다. QA 역시 기존에는 화이트박스 테스트만 진행했었지만, 개발자가 테스트케이스를 작성하고 테스터가 블랙박스 테스트를 진행함으로써 다양한 문제 상황을 배포 전에 더욱 확실히 잡을 수 있었습니다.</p>
<p>이번 API 순차 요청을 하게 된 계기 역시 블랙박스 테스트 도중 발견된 문제를 해결하기 위해 진행되었으며, 개발자가 미쳐 고려하지 못했던 부분을 잡아줄 수 있는 충분한 QA 프로세스가 있었다는 점에서 훨씬 안심하고 프로젝트를 진행 할 수 있었습니다.</p>
<p>감사합니다.</p></section><aside class="tocContainer"><ul>
<li><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">들어가며</a></li>
<li><a href="#%EB%A1%9C%EA%B7%B8%EC%9D%B8%EC%9D%B4-%EC%9C%A0%EC%A7%80%EB%90%98%EB%8A%94-%EC%9D%B4%EC%9C%A0">로그인이 유지되는 이유</a></li>
<li><a href="#json-web-token">JSON WEB TOKEN</a></li>
<li><a href="#%EC%98%A4%EB%A5%98-%EA%B2%B9%EC%B9%98%EA%B8%B0">오류 겹치기</a></li>
<li><a href="#api-%EC%88%9C%EC%B0%A8-%EC%9A%94%EC%B2%AD">API 순차 요청</a></li>
<li><a href="#%EC%9D%B8%EC%95%B1%EA%B2%B0%EC%A0%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%97%90-%EB%8C%80%ED%95%9C-%ED%9A%8C%EA%B3%A0">인앱결제 프로젝트에 대한 회고</a></li>
</ul></aside><hr/><footer><div class="bio"><div style="display:flex;align-items:center"><div data-gatsby-image-wrapper="" style="object-fit:cover" class="gatsby-image-wrapper gatsby-image-wrapper-constrained bio-avatar"><div style="max-width:90px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;90&#x27;%20width=&#x27;90&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/static/300e9efb654785ab2bbb3cfad0cd6ea4/c914c/profile-pic.avif 23w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/804a8/profile-pic.avif 45w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/08179/profile-pic.avif 90w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/07601/profile-pic.avif 180w" sizes="(min-width: 90px) 90px, 100vw"/><source type="image/webp" data-srcset="/static/300e9efb654785ab2bbb3cfad0cd6ea4/65086/profile-pic.webp 23w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/29677/profile-pic.webp 45w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/5d191/profile-pic.webp 90w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/52f83/profile-pic.webp 180w" sizes="(min-width: 90px) 90px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 90px) 90px, 100vw" decoding="async" loading="lazy" data-src="/static/300e9efb654785ab2bbb3cfad0cd6ea4/25ed1/profile-pic.png" data-srcset="/static/300e9efb654785ab2bbb3cfad0cd6ea4/9a626/profile-pic.png 23w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/e4dc7/profile-pic.png 45w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/25ed1/profile-pic.png 90w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/a2c25/profile-pic.png 180w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/300e9efb654785ab2bbb3cfad0cd6ea4/c914c/profile-pic.avif 23w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/804a8/profile-pic.avif 45w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/08179/profile-pic.avif 90w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/07601/profile-pic.avif 180w" sizes="(min-width: 90px) 90px, 100vw"/><source type="image/webp" srcSet="/static/300e9efb654785ab2bbb3cfad0cd6ea4/65086/profile-pic.webp 23w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/29677/profile-pic.webp 45w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/5d191/profile-pic.webp 90w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/52f83/profile-pic.webp 180w" sizes="(min-width: 90px) 90px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 90px) 90px, 100vw" decoding="async" loading="lazy" src="/static/300e9efb654785ab2bbb3cfad0cd6ea4/25ed1/profile-pic.png" srcSet="/static/300e9efb654785ab2bbb3cfad0cd6ea4/9a626/profile-pic.png 23w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/e4dc7/profile-pic.png 45w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/25ed1/profile-pic.png 90w,/static/300e9efb654785ab2bbb3cfad0cd6ea4/a2c25/profile-pic.png 180w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><div><h3>안녕하세요 🙌🏻 동수입니다.</h3><p>주어진 상황에서 최고의 퍼포먼스를 내기위해 최선을 다하고 있습니다.</p><p>기억보단 기록을, 기록보단 공유하는 것을 좋아합니다.</p><p style="margin-bottom:1vh">현재는<!-- --> <a href="https://camfit.co.kr/" target="_blank">캠핏</a>에서 웹 프론트 개발을 하고 있습니다. 🎃</p><div style="display:grid;grid-template-columns:1fr;row-gap:10px"><p style="margin-right:2vw">📬 : sonicce99@naver.com</p><div style="display:flex;align-items:center"><a href="https://github.com/sonicce99" target="_blank" rel="noreferrer"><img src="/static/github-1c95b85d86a7c25b6f3c3aef89f18afa.png" style="background:white;border-radius:15px;margin-right:15px" width="25px" alt="github"/></a><a href="https://sonicce99.notion.site/907ecc80c359442c910659a926d2eb30" target="_blank" rel="noreferrer"><img src="/static/notion-d9c1379e0d949af82eea7dde146d5243.png" style="background:white;border-radius:15px;margin-right:15px" width="25px" alt="notion"/></a><a href="https://nextjs-css-storybook.vercel.app/" target="_blank" rel="noreferrer"><img src="/static/storybook-1866d65b5d0e00fb4b682b99d7c693e5.png" style="background:white;border-radius:15px" width="25px" alt="storybook"/></a></div></div></div></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/redux-saga/">← <!-- -->React-Saga 공식문서 번역본</a></li><li><a rel="next" href="/review/2023/">2023년 회고<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2024<!-- -->, Welcome to my Github<!-- --> <a href="https://github.com/sonicce99" target="_blank" rel="noreferrer">DongSu Lee</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/shopby/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-72191eb2aad056040f91.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-c497c2a8fec0ff6aa06e.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-3348bc55e19344f1fbbe.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-0cbb2790a62d949f3290.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="a954078f0db9afc09923";</script><script src="/webpack-runtime-33e84a17abe76146d4db.js" async></script><script src="/framework-c140278f43aed2f020e8.js" async></script><script src="/app-72191eb2aad056040f91.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>